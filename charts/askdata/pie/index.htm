<!doctype html>
<html>
<head>
  <title>Askdata - Pie Chart</title>
  <script src="../lib/Chart.min.js"></script>
  <script src="../lib/utils.js"></script>
<script src="../lib/jquery.min.js"></script>
  <script src="env.js"></script>
  <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css" href="../lib/style.css">

<script type="text/javascript">
function getChartId(){
var chartId = window.location.href.split('#')[1];
return chartId;
}</script>
</head>
<body onload="getChartId()"><div id="container" style="width: 100%;min-height: 600px"><canvas id="canvas"></canvas></div>
<script>
$.ajax({
         url: environment + "/charts/" + getChartId(),
         type: "GET",
         beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + token
          ).setRequestHeader('Content-Type','application/json')},
         success: function(data) { 
          
          
          console.log(data);
          //var MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
          var MONTHS = [data.resultSet.dimension.labels];
    var color = Chart.helpers.color;
var measures = [];
for(var i in data.resultSet.measures) {  
    var item = data.resultSet.measures[i];
    
    // Smarter chart
    // TODO / to be removed Set accent color as the first color
    //if (i==0) {item.color = data.resultSet.color.accent; }

    
    measures.push({ 
        "label" : item.name,
        "data" : item.numericValues,
        "backgroundColor": data.resultSet.color.palette,
        
        "borderWidth": 0
    });

}

    // Show legend if measures more than one
    var displayLegend = true
    
    if (measures.length == 1) {
      displayLegend = false;

    }

    var chartData = {
      labels: data.resultSet.dimension.labels,
      datasets: measures,
    };

    // Todo - replace with dynamic locale, rounding, currency and measurement units
    // Scales should be aggregated by measurement units
    // Color is used as 3rd axis if the measurements units are greaten than 2
    var labelNumberRoundTo = 2;
    var labelNumberLocale = 'en-US';
    var labelFontSize = 20;
    var labelFontFamily = "'Helvetica', sans-serif";
    var lebelNumberCurrency = null;
    var lebelNumberMeasurmenentUnit = null;

      var ctx = document.getElementById('canvas').getContext('2d');



      window.myHorizontalBar = new Chart(ctx, {
        type: 'pie',
        data: chartData,
        options: {

          // Elements options apply to all of the options unless overridden in a dataset
          // In this case, we are setting the border of each horizontal bar to be 2px wide
          responsive: true,
          maintainAspectRatio:false,
          legend: {
            display : displayLegend,
            position: 'top',
            align: 'center',
            fontSize:30,
            padding: 5,
            labels: {
            usePointStyle: true}
          },
          title: {
            display: true,
            text: data.title,
            fontSize: 30,
            fontStyle:'normal'
          }
        }
      });
    var colorNames = Object.keys(window.chartColors);
}
});  
  </script>
</body>
</html>