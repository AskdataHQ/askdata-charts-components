<!--
    THIS EXAMPLE WAS DOWNLOADED FROM https://echarts.apache.org/examples/en/editor.html?c=scatter-linear-regression
-->
<!DOCTYPE html>
<html style="height: 100%">
    <head>
        <meta charset="utf-8">
        
    	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">


		<!-- These imports are required -->
		
		<script src="/lib/scripts/utils.js"></script>
		
		<script src="/lib/scripts/env.js"></script>
		
		<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>

		<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
		
		
		
		<script src="/lib/scripts/jquery.min.js"></script>
		
		
		<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>


        
        
		<!-- These import is needed for calculate regression -->
		<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat@latest/dist/ecStat.min.js"></script>

	
	
		<!-- Default styling -->
		
		<link href="/lib/styles/css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" type="text/css" href="/lib/styles/style.css">
		
	</head>
	
		<body style="height: 100%; width: 100%; margin: 0">
       		<div id="container" style="height: 100%; width: 100%"></div>
   		</body>
		
		
    <script type="text/javascript">
        
        
        

$.ajax({        

url: environment_widget + "/smartinsight/widgets/" + getUrlParameter('widgetId'),
type: "GET",
async: false,
beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + getToken() 
 ).setRequestHeader('Content-Type','application/json')},
success: function(data) {
        
	var dom = document.getElementById("container");
	
	var template = document.getElementById('container').innerHTML;
	var myChart = echarts.init(dom);
	var app = {};
	
	var option;


	// See https://github.com/ecomfe/echarts-stat
	echarts.registerTransform(ecStat.transform.regression);

	
	
	
    
    function check_thousand(value) {
        return value >= 1000;
    }

	
	var dataAll = [[
	]];
	
	if (data.fields.s2_id.data.every(check_thousand) == true) {
	
        for(var i=0; i<data.fields.s1_id.data.length; i++)
    
        
            dataAll[0].push([data.fields.s1_id.data[i], data.fields.s2_id.data[i]/1000]);
        
            } else {
                    
                    for(var i=0; i<data.fields.s1_id.data.length; i++)
                    
                    dataAll[0].push([data.fields.s1_id.data[i], data.fields.s2_id.data[i]]);
                    
            
            }
    
    /*
    
    
    
    var data_x = [10.0, 8.0, 13.0, 9.0, 11.0, 14.0, 6.0, 4.0, 12.0, 7.0, 5.0];
    
    var data_y = [8.04, 6.95, 7.58, 8.81, 8.33, 9.96, 7.24, 4.26, 10.84, 4.82, 5.68];
    
    
	for(var i=0; i<data_x.length; i++)
		
		dataAll[0].push([data_x[i], data_y[i]]);

    */

	option = {
	
	    title: [{
            text: "titolo",//data.fields.d1_id.data[0],
            left: "27%",
            top: "1%",
            show: true
        }],
    	dataset: [{
        	source: dataAll[0]
    	}, {
        transform: {
            type: 'ecStat:regression'
            // 'linear' by default.
            // config: { method: 'linear', formulaOn: 'end'}
        }
    	}],
    	grid: [
        {left: '15%', top: '7%', width: '30%', height: '30%'},
        {right: '5%', top: '7%', width: '30%', height: '30%'},
        {left: '15%', bottom: '7%', width: '30%', height: '30%'},
        {right: '5%', bottom: '7%', width: '30%', height: '30%'}
    	],
    	
    	
    	xAxis: [
        {
            gridIndex: 0,  offset: 15,
            min: function (value) {
                return Math.round(value.min)
            },
            max: function (value) {
                return Math.round(value.max)
            },
            axisLabel: {
                
                formatter: "{value} %"
                        },
            
        },
        {gridIndex: 1},
        {gridIndex: 2},
        {gridIndex: 3}
    	],
    	
    	yAxis: [
        {
            gridIndex: 0, offset: 15,
            min: function (value) {
                return Math.round(value.min)
            },
            max: function (value) {
                return Math.round(value.max)
            },
            splitNumber: 4,
            axisLabel: {
                formatter: "{value} â‚¬"
                        },
                        
                        
            
        },
        {gridIndex: 1},
        {gridIndex: 2},
        {gridIndex: 3}
    	],
    	
    	series: [{
            name: 'scatter',
            type: 'scatter',
            datasetIndex: 0,
            xAxisIndex: 0,
            yAxisIndex: 0
    	}, 
    	{
            name: 'line',
            type: 'line',
            datasetIndex: 1,
            symbolSize: 0.1
    }]
};

if (option && typeof option === 'object') {
    myChart.setOption(option);
}
}
});

        </script>
</html>
    