<!DOCTYPE html>
<html style="height: 100%">
    <head>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

        <!-- Beginning Include Header -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

<script src="https://cdn.jsdelivr.net/npm/js-cookie@rc/dist/js.cookie.min.js"></script>
<script src="/lib/scripts/utils.js"></script>
<script src="/lib/scripts/env.js"></script>
<script src="/lib/scripts/jquery.min.js"></script>
<link href="/lib/styles/css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/lib/styles/style.css">
<script src="https://unpkg.com/mustache@latest"></script>

<!-- End Include Header -->
    </head>
    <body style="height: 100%; margin: 0">
        <div id="container" style="height: 100%"></div>
    </body>


    <script>
environment_widget = "https://api-dev.askdata.com";
//environment_widget = "https://api.askdata.com"  // prod  da togliere quando porto su...

// Request charting data
$.ajax({

        url: environment_widget +"/smartinsight/widgets/" + getUrlParameter('widgetId'),
        type: "GET",
        async: false,
        beforeSend: function(xhr){xhr.setRequestHeader('Authorization', 'Bearer ' + getToken() 
        ).setRequestHeader('Content-Type','application/json')},
        success: function(data) { 
     

        //data.fields = data.fields.filter(function( obj ) {
        // take the length of array results
        measures_list =[]
        keys_data = $.map(data.fields, function(v, i){
                            if (v.type != 'query') {
                                measures_list.push(v)
                                return i; 
                            }
                        }
                    );


        // d1_id is a dimension

        dimension_array = data.fields.d1_id.data  
        console.log(data.fields[keys_data[0]].data)

        var datasets = data.fields.d1_id.data.map(function(v,i) {
                    return {'dimension': v, 
                            'measure': [data.fields.m1_id.data[i], data.fields.m2_id.data[i],data.fields.m3_id.data[i], data.fields.m4_id.data[i],data.fields.m5_id.data[i]]}
                           });
     
        console.log(dimension_array)

        list_of_measures = [data.fields.m1_id.name, data.fields.m2_id.name, data.fields.m3_id.name, data.fields.m4_id.name, data.fields.m5_id.name]

        var massimo_ar = [];
        datasets.forEach(function(item) {
                    if (item.dimension == 'Massimo Serie A'){
                        massimo_ar = item.measure
                    }
                });

        var indicator_ar_1 = list_of_measures.map(e => ({name: e}))

        var indicator_ar_2= massimo_ar.map(e => ({max: e}))
        
        var indicator_ar = indicator_ar_1.map((o, i) => ({name: o.name, max: indicator_ar_2[i].max}))


        

        var dom = document.getElementById("container");
        var myChart = echarts.init(dom);
        var app = {};

        var option;


        option = {
            title: {},
            tooltip: {},
            legend: {
                data: dimension_array
            },
            radar: {
                shape: 'circle',
                name: {
                    textStyle: {
                        color: '#000000',
                        borderRadius: 3,
                        padding: [3, 5],
                        fontSize : 15
                    }
                },
                indicator: [
                    { name: 'Contrasti vinti',max: 254},
                    { name: 'Falli commessi', max:63},
                    { name: 'Palle recuperate', max: 273},
                    { name: 'Tackle vinti', max: 53},
                    { name: 'Passaggi riusciti', max: 1960}
                    ]
            },
            series: [{
                name: 'Players',
                type: 'radar',
                // areaStyle: {normal: {}},
                data: [
                    {
                        value: [141, 52, 211, 22, 1380],
                        name: dimension_array[0]
                    },
                    {
                        value: [206, 48, 169, 31.0, 1133],
                        name: dimension_array[1]
                    },{
                        value: [42, 11,  48,  7, 313],
                        name: dimension_array[2]
                    }
                ]
            }]
        };

        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }

          }
          });

        /*
        // Redirect to login if not authenticated 
        $(document).ajaxError(function( event, jqxhr, settings, exception ) {
            if ( jqxhr.status== 401 ) {
              location.replace(environment_auth+"/login");

            }
        });
        */

          </script>
        </html>
            